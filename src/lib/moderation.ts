// çº¯å…³é”®è¯å±æœºæ£€æµ‹ï¼ˆä¸ä¾èµ– OpenAI Moderation APIï¼Œå…¼å®¹ DeepSeek ç­‰å›½å†…å¹³å°ï¼‰

// ä¸­æ–‡å±æœºå…³é”®è¯
const CRISIS_KEYWORDS_ZH = [
  'æƒ³æ­»', 'ä¸æƒ³æ´»', 'è‡ªæ€', 'è‡ªæ®‹', 'å‰²è…•', 'è·³æ¥¼', 'è·³æ²³',
  'ç»“æŸç”Ÿå‘½', 'ç¦»å¼€è¿™ä¸ªä¸–ç•Œ', 'æ´»ç€æ²¡æ„æ€', 'ä¸å¦‚æ­»äº†',
  'æ€äº†', 'æƒ³æ€', 'å¼„æ­»', 'æ‰“æ­»', 'ä¼¤å®³ä»–',
  'ä¸æƒ³æ´»äº†', 'åŽ»æ­»', 'å¯»æ­»', 'è½»ç”Ÿ', 'äº†ç»“',
];

// å±æœºå›žå¤æ¨¡æ¿
export const CRISIS_RESPONSE = `æˆ‘å¬åˆ°äº†ä½ è¯´çš„è¯ï¼Œè¿™è®©æˆ‘éžå¸¸æ‹…å¿ƒä½ çš„å®‰å…¨ã€‚

ä½ çŽ°åœ¨çš„æ„Ÿå—ä¸€å®šå¾ˆç—›è‹¦ï¼Œæˆ‘æƒ³è®©ä½ çŸ¥é“ï¼Œä½ å¹¶ä¸å­¤å•ã€‚

è¯·çŽ°åœ¨å°±è”ç³»ä¸“ä¸šçš„å¸®åŠ©ï¼š
ðŸ“ž **å…¨å›½å¿ƒç†æ´åŠ©çƒ­çº¿**: 400-161-9995
ðŸ“ž **åŒ—äº¬å¿ƒç†å±æœºç ”ç©¶ä¸Žå¹²é¢„ä¸­å¿ƒ**: 010-82951332
ðŸ“ž **ç”Ÿå‘½çƒ­çº¿**: 400-821-1215

å¦‚æžœä½ æœ‰ç«‹å³çš„å±é™©ï¼Œè¯·æ‹¨æ‰“ **120** æˆ–å‰å¾€æœ€è¿‘çš„åŒ»é™¢æ€¥è¯Šã€‚

åœ¨ä½ èŽ·å¾—å¸®åŠ©ä¹‹å‰ï¼Œè¯·å°½é‡ï¼š
- å¾…åœ¨å®‰å…¨çš„åœ°æ–¹
- è”ç³»ä½ ä¿¡ä»»çš„äººé™ªä¼´ä½ 
- è¿œç¦»å¯èƒ½ä¼¤å®³è‡ªå·±çš„ç‰©å“

ä½ çš„ç”Ÿå‘½å¾ˆçè´µï¼Œä¸“ä¸šçš„å¸®åŠ©å¯ä»¥è®©äº‹æƒ…å˜å¾—ä¸ä¸€æ ·ã€‚â¤ï¸`;

export interface ModerationResult {
  isCrisis: boolean;
  crisisKeywordsFound: string[];
}

/**
 * æ£€æŸ¥ç”¨æˆ·æ¶ˆæ¯æ˜¯å¦åŒ…å«å±æœºå†…å®¹ï¼ˆçº¯å…³é”®è¯åŒ¹é…ï¼Œæ— éœ€å¤–éƒ¨ APIï¼‰
 */
export function checkModeration(text: string): ModerationResult {
  const lowerText = text.toLowerCase();

  const crisisKeywordsFound = CRISIS_KEYWORDS_ZH.filter(keyword =>
    lowerText.includes(keyword)
  );

  return {
    isCrisis: crisisKeywordsFound.length > 0,
    crisisKeywordsFound,
  };
}
